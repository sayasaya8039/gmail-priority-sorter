import{g as s,s as o}from"./storage-CS1t7rav.js";import{c as a}from"./classifier-BcIm6e9n.js";chrome.runtime.onInstalled.addListener(t=>{t.reason==="install"?(console.log("Gmail Priority Sorter がインストールされました"),chrome.runtime.openOptionsPage()):t.reason==="update"&&console.log("Gmail Priority Sorter が更新されました")});chrome.runtime.onMessage.addListener((t,r,e)=>(n(t,e),!0));async function n(t,r){try{switch(t.type){case"GET_SETTINGS":{const e=await s();r({type:"SETTINGS_RESPONSE",settings:e});break}case"UPDATE_SETTINGS":{const i={...await s(),...t.settings};await o(i),r({success:!0,settings:i}),c({type:"SETTINGS_UPDATED",settings:i});break}case"CLASSIFY_EMAILS":{const e=await s(),i=a(t.emails,e);r({type:"CLASSIFICATION_RESULT",results:i});break}default:r({error:"不明なメッセージタイプ"})}}catch(e){console.error("メッセージ処理エラー:",e),r({error:String(e)})}}async function c(t){const r=await chrome.tabs.query({url:"https://mail.google.com/*"});for(const e of r)if(e.id)try{await chrome.tabs.sendMessage(e.id,t)}catch{}}chrome.action.onClicked.addListener(async t=>{t.url?.includes("mail.google.com")&&t.id&&chrome.tabs.sendMessage(t.id,{type:"SORT_EMAILS"})});console.log("Gmail Priority Sorter Service Worker 起動完了");
