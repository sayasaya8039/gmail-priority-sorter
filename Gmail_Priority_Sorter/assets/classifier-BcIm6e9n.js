const a=["緊急","至急","急ぎ","URGENT","urgent","ASAP","asap","今日中","本日中","即日","直ちに","immediately","重要","要対応","要返信","要確認","期限","deadline","Deadline","締切","締め切り"],g=["会議","ミーティング","meeting","Meeting","MTG","mtg","打ち合わせ","打合せ","予定","スケジュール","schedule","calendar","Calendar","招待","invitation","Invitation","Zoom","zoom","Teams","Google Meet","Webex"],p=["確認してください","ご確認","お願いします","お願い致します","返信","reply","Reply","response","Response","承認","申請","approval","Approval","request","Request","レビュー","review","Review","feedback","Feedback"],S=["ニュースレター","newsletter","Newsletter","配信","お知らせ","最新情報","update","Update","digest","Digest","weekly","Weekly","monthly","Monthly"],y=["セール","sale","Sale","SALE","割引","discount","Discount","クーポン","coupon","Coupon","キャンペーン","campaign","限定","特別","special","Special","offer","Offer","無料","free","Free","FREE","お得","ポイント"],l=["Twitter","twitter","X.com","Facebook","facebook","LinkedIn","linkedin","Instagram","instagram","いいね","like","Like","コメント","comment","Comment","フォロー","follow","Follow","メンション","mention","リツイート","retweet","share","Share"],m=[/noreply@/i,/no-reply@/i,/donotreply@/i,/notifications?@/i,/newsletter@/i,/marketing@/i,/info@/i,/support@/i,/mailer@/i];function E(e,t){const s=t.caseSensitive?e:e.toLowerCase(),n=t.caseSensitive?t.value:t.value.toLowerCase();switch(t.matchType){case"contains":return s.includes(n);case"startsWith":return s.startsWith(n);case"endsWith":return s.endsWith(n);case"exact":return s===n;case"regex":try{const r=t.caseSensitive?"":"i";return new RegExp(t.value,r).test(e)}catch{return!1}default:return!1}}function i(e,t){const s=e.toLowerCase();return t.some(n=>s.includes(n.toLowerCase()))}function d(e,t){const s=e.toLowerCase();return t.filter(n=>s.includes(n.toLowerCase())).length}function h(e){return m.some(t=>t.test(e))}function L(e){const t=`${e.subject} ${e.snippet}`;return i(t,a)?"urgent":i(t,g)?"meeting":i(t,p)?"action":i(e.sender,l)||i(e.subject,l)?"social":i(t,y)?"promotion":i(t,S)||h(e.sender)?"newsletter":"other"}function R(e,t,s){let n=50;const r=`${e.subject} ${e.snippet}`;n+={urgent:30,important:20,meeting:15,action:15,fyi:0,newsletter:-20,promotion:-25,social:-15,other:0}[t],n+=d(r,a)*10,n+=d(r,p)*5,e.isUnread&&(n+=10),e.isStarred&&(n+=15),e.hasAttachment&&(n+=5),s.vipList.some(o=>e.sender.toLowerCase().includes(o.toLowerCase()))&&(n+=30),s.ignoreList.some(o=>e.sender.toLowerCase().includes(o.toLowerCase()))&&(n-=40),h(e.sender)&&(n-=20);for(const o of s.customRules){if(!o.enabled)continue;o.conditions.every(f=>{const w=e[f.field];return E(w,f)})&&(n+=o.scoreBoost)}return Math.max(0,Math.min(100,n))}function C(e){return e>=80?"critical":e>=60?"high":e>=40?"medium":"low"}function T(e,t,s,n){const r=[],c=`${e.subject} ${e.snippet}`,o=n.vipList.find(u=>e.sender.toLowerCase().includes(u.toLowerCase()));return o&&r.push(`VIP送信者: ${o}`),t==="urgent"&&i(c,a)&&r.push("緊急キーワードを検出"),t==="meeting"&&r.push("会議・予定に関連"),t==="action"&&r.push("対応が必要な内容"),e.isUnread&&r.push("未読"),e.isStarred&&r.push("スター付き"),e.hasAttachment&&r.push("添付ファイルあり"),r.length===0&&r.push("標準分類"),r.join(" / ")}function b(e,t){const s=L(e),n=R(e,s,t),r=C(n),c=T(e,s,n,t);return{elementId:e.elementId,sender:e.sender,subject:e.subject,snippet:e.snippet,date:e.date,priority:r,urgencyScore:n,category:s,reason:c}}function O(e,t){return e.map(n=>b(n,t)).sort((n,r)=>r.urgencyScore-n.urgencyScore)}export{O as c};
