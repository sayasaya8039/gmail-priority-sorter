import{g as x}from"./storage-CS1t7rav.js";import{c as A}from"./classifier-BcIm6e9n.js";const p={critical:{label:"ç·Šæ€¥",color:"#DC2626",bgColor:"#FEE2E2"},high:{label:"é«˜",color:"#EA580C",bgColor:"#FFEDD5"},medium:{label:"ä¸­",color:"#2563EB",bgColor:"#DBEAFE"},low:{label:"ä½Ž",color:"#6B7280",bgColor:"#F3F4F6"}},L={urgent:{label:"ç·Šæ€¥",icon:"ðŸš¨",color:"#DC2626"},important:{label:"é‡è¦",icon:"â­",color:"#F59E0B"},meeting:{label:"ä¼šè­°",icon:"ðŸ“…",color:"#8B5CF6"},action:{label:"è¦å¯¾å¿œ",icon:"ðŸ“‹",color:"#3B82F6"},fyi:{label:"å‚è€ƒ",icon:"ðŸ“",color:"#10B981"},newsletter:{label:"ãƒ‹ãƒ¥ãƒ¼ã‚¹",icon:"ðŸ“°",color:"#6366F1"},promotion:{label:"ãƒ—ãƒ­ãƒ¢",icon:"ðŸ·ï¸",color:"#EC4899"},social:{label:"SNS",icon:"ðŸ’¬",color:"#14B8A6"},other:{label:"ãã®ä»–",icon:"ðŸ“§",color:"#6B7280"}};let l=null,g=!1,u=null;async function b(){console.log("Gmail Priority Sorter: åˆæœŸåŒ–é–‹å§‹");try{if(l=await x(),!l.enabled){console.log("Gmail Priority Sorter: ç„¡åŠ¹åŒ–ã•ã‚Œã¦ã„ã¾ã™");return}await T(),await d(),S(),chrome.runtime.onMessage.addListener(B),console.log("Gmail Priority Sorter: åˆæœŸåŒ–å®Œäº†")}catch(t){console.error("Gmail Priority Sorter: åˆæœŸåŒ–ã‚¨ãƒ©ãƒ¼",t)}}function T(){return new Promise(t=>{const e=()=>{document.querySelector('[role="main"]')?t():setTimeout(e,500)};e()})}function B(t){switch(t.type){case"SORT_EMAILS":d();break;case"REFRESH":d();break;case"SETTINGS_UPDATED":t.settings&&(l=t.settings,d());break}}function S(){u&&u.disconnect(),u=new MutationObserver(e=>{g||e.some(r=>r.addedNodes.length>0||r.removedNodes.length>0)&&R()});const t=document.querySelector('[role="main"]');t&&u.observe(t,{childList:!0,subtree:!0})}let y=null;function R(){y&&clearTimeout(y),y=window.setTimeout(()=>{d()},300)}async function d(){if(!(g||!l?.enabled)){g=!0;try{const t=F();if(t.length===0)return;const e=$(t),o=A(e,l);v(o,t),l.autoSort&&P(o,t)}catch(t){console.error("Gmail Priority Sorter: å‡¦ç†ã‚¨ãƒ©ãƒ¼",t)}finally{g=!1}}}function F(){const t=["tr.zA","[data-legacy-thread-id]",".zE",".yO"];for(const o of t){const r=document.querySelectorAll(o);if(r.length>0)return Array.from(r)}const e=document.querySelectorAll('[role="main"] table tbody tr');return Array.from(e).filter(o=>o.querySelector("[data-thread-id]")||o.querySelector("[email]")||o.classList.contains("zA"))}function $(t){return t.map((e,o)=>{const r=`email-row-${o}`;e.setAttribute("data-gps-id",r);const n=e.querySelector("[email]")||e.querySelector(".yX.xY span[name]")||e.querySelector(".yW span"),s=n?.getAttribute("email")||n?.getAttribute("name")||n?.textContent?.trim()||"ä¸æ˜Ž",i=(e.querySelector(".bog")||e.querySelector(".y6")||e.querySelector("[data-thread-subject]"))?.textContent?.trim()||"",f=(e.querySelector(".y2")||e.querySelector(".Zt"))?.textContent?.trim()||"",a=e.querySelector(".xW.xY span")||e.querySelector("[title]"),h=a?.getAttribute("title")||a?.textContent?.trim()||"",E=e.classList.contains("zE")||e.querySelector(".zE")!==null||e.style.fontWeight==="bold",C=e.querySelector(".aZo")!==null||e.querySelector('[data-tooltip="æ·»ä»˜ãƒ•ã‚¡ã‚¤ãƒ«ã‚ã‚Š"]')!==null,q=e.querySelector(".T-KT.T-KT-Jp")!==null||e.querySelector('[data-tooltip*="ã‚¹ã‚¿ãƒ¼"]')?.getAttribute("aria-label")?.includes("ã‚¹ã‚¿ãƒ¼ä»˜ã")===!0;return{elementId:r,sender:s,subject:i,snippet:f,date:h,isUnread:E,hasAttachment:C,isStarred:q}})}function v(t,e){l&&t.forEach(o=>{const r=e.find(c=>c.getAttribute("data-gps-id")===o.elementId);if(!r)return;const n=r.querySelector(".gps-badge");n&&n.remove();const s=r.querySelector(".gps-score");if(s&&s.remove(),l.showBadges){const c=I(o),i=r.querySelector("td:nth-child(3)")||r.querySelector("td");i&&i.insertBefore(c,i.firstChild)}if(l.showScores){const c=O(o),i=r.querySelector(".xW")||r.querySelector("td:last-child");i&&i.appendChild(c)}G(r,o)})}function I(t){const e=document.createElement("span");e.className="gps-badge";const o=L[t.category],r=p[t.priority];return e.innerHTML=`
    <span class="gps-category" style="color: ${o.color}">
      ${o.icon}
    </span>
    <span class="gps-priority" style="background: ${r.bgColor}; color: ${r.color}">
      ${r.label}
    </span>
  `,e.style.cssText=`
    display: inline-flex;
    align-items: center;
    gap: 4px;
    margin-right: 8px;
    font-size: 11px;
    vertical-align: middle;
  `,e.title=`${o.label} / ${t.reason}`,e}function O(t){const e=document.createElement("span");e.className="gps-score";const o=p[t.priority];return e.textContent=`${t.urgencyScore}`,e.style.cssText=`
    display: inline-block;
    min-width: 24px;
    height: 18px;
    line-height: 18px;
    text-align: center;
    font-size: 10px;
    font-weight: bold;
    color: white;
    background: ${o.color};
    border-radius: 9px;
    margin-left: 8px;
  `,e.title=`ç·Šæ€¥åº¦ã‚¹ã‚³ã‚¢: ${t.urgencyScore}/100`,e}function G(t,e){t.classList.remove("gps-critical","gps-high","gps-medium","gps-low"),t.classList.add(`gps-${e.priority}`);const o=p[e.priority];e.priority==="critical"||e.priority==="high"?t.style.borderLeft=`3px solid ${o.color}`:t.style.borderLeft=""}function P(t,e){const o=e[0]?.parentElement;if(!o)return;u?.disconnect(),[...e].sort((n,s)=>{const c=t.find(a=>a.elementId===n.getAttribute("data-gps-id")),i=t.find(a=>a.elementId===s.getAttribute("data-gps-id")),m=c?.urgencyScore??0;return(i?.urgencyScore??0)-m}).forEach(n=>{o.appendChild(n)}),setTimeout(()=>S(),100)}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",b):b();
