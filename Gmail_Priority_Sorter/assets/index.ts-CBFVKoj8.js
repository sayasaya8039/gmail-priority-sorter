import{g as a,s as i}from"./storage-CS1t7rav.js";import{c as s}from"./classifier-BcIm6e9n.js";chrome.runtime.onInstalled.addListener(t=>{t.reason==="install"?(console.log("Gmail Priority Sorter がインストールされました"),chrome.runtime.openOptionsPage()):t.reason==="update"&&console.log("Gmail Priority Sorter が更新されました")});chrome.tabs.onUpdated.addListener(async(t,r,e)=>{if(r.status==="complete"&&e.url?.includes("mail.google.com"))try{await chrome.sidePanel.setOptions({tabId:t,path:"src/sidepanel/index.html",enabled:!0}),console.log("Gmail Priority Sorter: サイドパネルを有効化しました")}catch(o){console.error("サイドパネルの有効化に失敗:",o)}});chrome.action.onClicked.addListener(async t=>{if(t.id)try{await chrome.sidePanel.open({tabId:t.id})}catch(r){console.error("サイドパネルを開けませんでした:",r)}});chrome.runtime.onMessage.addListener((t,r,e)=>(n(t,e),!0));async function n(t,r){try{switch(t.type){case"GET_SETTINGS":{const e=await a();r({type:"SETTINGS_RESPONSE",settings:e});break}case"UPDATE_SETTINGS":{const o={...await a(),...t.settings};await i(o),r({success:!0,settings:o}),c({type:"SETTINGS_UPDATED",settings:o});break}case"CLASSIFY_EMAILS":{const e=await a(),o=s(t.emails,e);r({type:"CLASSIFICATION_RESULT",results:o});break}default:r({error:"不明なメッセージタイプ"})}}catch(e){console.error("メッセージ処理エラー:",e),r({error:String(e)})}}async function c(t){const r=await chrome.tabs.query({url:"https://mail.google.com/*"});for(const e of r)if(e.id)try{await chrome.tabs.sendMessage(e.id,t)}catch{}}console.log("Gmail Priority Sorter Service Worker 起動完了");
